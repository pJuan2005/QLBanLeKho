<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Create Product</title>
  <link rel="stylesheet" href="../Shared/css/create product.css" />
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">üõí RetailPro<br><span>Inventory & POS</span></div>
        <nav>
            <ul>
                <li><a href="#">Dashboard</a></li>
                <li><a href="#">POS</a></li>
                <li class="active"><a href="#">Products</a></li>
                <li><a href="#">Categories</a></li>
                <li><a href="#">Customers</a></li>
                <li><a href="#">Suppliers</a></li>
                <li><a href="#">Purchase Orders</a></li>
                <li><a href="#">Stock Management</a></li>
                <li><a href="#">Sales & Returns</a></li>
                <li><a href="#">Payments & Debts</a></li>
                <li><a href="#">Reports</a></li>
                <li><a href="#">Settings</a></li>
            </ul>
        </nav>
        <div class="user">
            <div class="avatar">J</div>
            <div class="info">
                <p>John Doe</p>
                <small>Admin</small>
            </div>
        </div>
    </aside>

    <!-- Main content -->
    <main class="main-content">
      <div class="header-bar">
        <h1>Create Product</h1>
        <a href="product.html" class="btn-back">‚Üê Back to Products</a>
      </div>

      <section class="form-section">
        <h2><span>‚ÑπÔ∏è</span> Product Information</h2>

        <form id="createProductForm" class="form-grid">
          <!-- Product Name -->
          <div class="form-group">
            <label>Product Name *</label>
            <input type="text" id="productName" required />
          </div>

          <!-- Category -->
          <div class="form-group">
            <label>Category *</label>
            <select id="category" required>
              <option value="">Select</option>
              <option value="1">Running Shoes</option>
              <option value="2">Sports Shoes</option>
            </select>
          </div>

          <!-- SKU -->
          <div class="form-group">
            <label>SKU *</label>
            <div class="input-with-btn">
              <input type="text" id="sku" required />
              <button type="button" id="generateSku">Generate</button>
            </div>
          </div>

          <!-- Barcode -->
          <div class="form-group">
            <label>Barcode</label>
            <input type="text" id="barcode" />
          </div>

          <!-- Unit -->
          <div class="form-group">
            <label>Unit</label>
            <select id="unit">
              <option value="">Select</option>
              <option>ƒê√¥i</option>
              <option>H·ªôp</option>
            </select>
          </div>

          <!-- Quantity -->
          <div class="form-group">
            <label>Quantity</label>
            <input type="number" id="quantity" min="0" value="0" />
          </div>

          <!-- Min Stock -->
          <div class="form-group">
            <label>Min Stock</label>
            <input type="number" id="minStock" min="0" value="0" />
          </div>

          <!-- VAT Rate -->
          <div class="form-group">
            <label>VAT Rate (%)</label>
            <input type="number" id="vatRate" min="0" step="0.01" placeholder="0.00" />
          </div>

          <!-- Status -->
          <div class="form-group">
            <label>Status</label>
            <select id="status">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>

          <!-- Image -->
          <div class="form-group full">
            <label>Product Image</label>
            <input type="file" id="image" accept="image/*" />
          </div>

          <!-- Buttons -->
          <div class="form-actions full">
            <button type="submit" class="btn-primary">Save Product</button>
            <button type="button" id="refreshForm" class="btn-refresh">üîÑ Refresh</button>
            <a href="product.html" class="btn-secondary">Cancel</a>
          </div>
        </form>
      </section>
    </main>
  </div>

  <script>
    // Generate SKU
    document.getElementById("generateSku").addEventListener("click", () => {
      const sku = "SKU-" + Math.floor(Math.random() * 1000000);
      document.getElementById("sku").value = sku;
    });

    // Refresh form
    document.getElementById("refreshForm").addEventListener("click", () => {
      const form = document.getElementById("createProductForm");
      form.reset();
      alert("ƒê√£ l√†m m·ªõi form!");
    });
  </script>
</body>

<script>
  const apiUrl = "https://localhost:7092/api/Product/create-product";

  // ====== T·∫°o SKU t·ª± ƒë·ªông ======
  document.getElementById("generateSku").addEventListener("click", () => {
    const sku = "SKU-" + Math.floor(Math.random() * 1000000);
    document.getElementById("sku").value = sku;
  });

  // ====== L√†m m·ªõi form ======
  document.getElementById("refreshForm").addEventListener("click", () => {
    document.getElementById("createProductForm").reset();
    alert("ƒê√£ l√†m m·ªõi form!");
  });

  // ====== Khi nh·∫•n "Save Product" ======
  document.getElementById("createProductForm").addEventListener("submit", async (e) => {
    e.preventDefault();

    // üß© L·∫•y gi√° tr·ªã t·ª´ form
    const productName = document.getElementById("productName").value.trim();
    const categoryID = parseInt(document.getElementById("category").value);
    const sku = document.getElementById("sku").value.trim();
    const barcode = document.getElementById("barcode").value.trim();
    const unit = document.getElementById("unit").value;
    const quantity = parseInt(document.getElementById("quantity").value) || 0;
    const minStock = parseInt(document.getElementById("minStock").value) || 0;
    const vatRate = parseFloat(document.getElementById("vatRate").value) || 0;
    const status = document.getElementById("status").value;
    const imageFile = document.getElementById("image").files[0];

    // üß† Ki·ªÉm tra d·ªØ li·ªáu b·∫Øt bu·ªôc
    if (!productName || !categoryID || !sku) {
      alert("‚ö†Ô∏è Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß Product Name, Category v√† SKU!");
      return;
    }

    // üóÇÔ∏è T·∫°o FormData ƒë·ªÉ g·ª≠i file v√† d·ªØ li·ªáu
    const formData = new FormData();
    formData.append("ProductName", productName);
    formData.append("CategoryID", categoryID);
    formData.append("SKU", sku);
    formData.append("Barcode", barcode);
    formData.append("Unit", unit);
    formData.append("Quantity", quantity);
    formData.append("MinStock", minStock);
    formData.append("VATRate", vatRate);
    formData.append("Status", status);

    if (imageFile) {
      formData.append("imageFile", imageFile); // G·ª≠i file th·∫≠t l√™n server
    }

    // üöÄ G·ª≠i d·ªØ li·ªáu l√™n API
    try {
      const response = await fetch(apiUrl, {
        method: "POST",
        body: formData
      });

      if (response.ok) {
        alert("‚úÖ Th√™m s·∫£n ph·∫©m th√†nh c√¥ng!");
        window.location.href = "product.html";
      } else {
        const errorText = await response.text();
        alert("‚ùå L·ªói khi th√™m s·∫£n ph·∫©m: " + errorText);
      }
    } catch (error) {
      alert("‚ö†Ô∏è Kh√¥ng th·ªÉ k·∫øt n·ªëi API: " + error.message);
    }
  });


</script>



</html>
