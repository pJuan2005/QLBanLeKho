<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
    rel="stylesheet" />

  <!-- css -->
  <link rel="stylesheet" href="../Shared/css/goodsreceipts.css" />
  <script src="../Shared/angular/angular.min.js"></script>
  <script src="../Shared/angular/global.js"></script>
  <script src="../Shared/angular/goodsreceipts.js"></script>
  <title>GoodsReceipts</title>
</head>

<body ng-app="AppRetailPos" ng-controller="goodsreceiptsCtrl">
  <div class="slide-bar">
    <div class="slide-bar__header">
      <div class="app-slideBar">
        <div class="app-slideBar__left">
          <img src="../Shared/img/common/wheel.svg" alt="" class="icon" />
        </div>
        <div class="app-slideBar__right">
          <h1 class="name-app">RetailPro</h1>
          <p class="title-nameApp">Inventory & POS</p>
        </div>
      </div>
    </div>
    <div class="slide-bar__Content">
      <p class="slide-bar__label">Navigation</p>
      <!-- menu button Dashboard -->
      <a href="../AdminFE/dashboard.html" ng-if="canShow('dashboard')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/dashboard.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Dashboard</p>
          </div>
        </div>
      </a>
      <!-- menu button POS -->
      <a href="../AdminFE/pos.html" ng-if="canShow('pos')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/pos.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">POS</p>
          </div>
        </div>
      </a>
      <!-- menu button Products -->
      <a href="../AdminFE/products.html" ng-if="canShow('products')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/product.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Products</p>
          </div>
        </div>
      </a>
      <!-- menu button Categories -->
      <a href="../AdminFE/categories.html" ng-if="canShow('categories')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/category.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Categories</p>
          </div>
        </div>
      </a>

      <!-- menu button Promotions -->
      <a href="../AdminFE/promotions.html" ng-if="canShow('promotions')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/promotion.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Promotions</p>
          </div>
        </div>
      </a>
      <!-- menu button Customers -->
      <a href="../AdminFE/customers.html" ng-if="canShow('customers')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/customer.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Customers</p>
          </div>
        </div>
      </a>
      <!-- menu button Suppliers -->
      <a href="../AdminFE/suppliers.html" ng-if="canShow('suppliers')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/supplier.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Suppliers</p>
          </div>
        </div>
      </a>
      <!-- menu button Purchase Orders -->
      <a href="../AdminFE/purchaseorders.html" ng-if="canShow('purchaseOrders')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/purchaseorder.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Purchase Orders</p>
          </div>
        </div>
      </a>
      <!-- menu button StockCard -->
      <a href="../AdminFE/stockcard.html" ng-if="canShow('stock')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/stock.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Stock Management</p>
          </div>
        </div>
      </a>

      <!-- menu button Goods Receipts -->
      <a href="../AdminFE/goodsreceipts.html" ng-if="canShow('greceipts')">
        <div class="slide-bar__MenuButton slide-bar__MenuButton--active">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/goodReceipt.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu-active">Goods Receipts</p>
          </div>
        </div>
      </a>

      <!-- menu button Goods Issues -->
      <a href="../AdminFE/goodsissues.html" ng-if="canShow('gissues')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/goodIssues.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Goods Issues</p>
          </div>
        </div>
      </a>

      <!-- menu button Sales -->
      <a href="../AdminFE/sales.html" ng-if="canShow('sales')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/sales.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Sales</p>
          </div>
        </div>
      </a>
      <!-- menu button Returns -->
      <a href="../AdminFE/returns.html" ng-if="canShow('returns')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/return.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Returns</p>
          </div>
        </div>
      </a>
      <!-- menu button Payments & Debts -->
      <a href="../AdminFE/payments.html" ng-if="canShow('payments')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/payments.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Payments & Debts</p>
          </div>
        </div>
      </a>
      <!-- menu button Reports -->
      <a href="../AdminFE/reports.html" ng-if="canShow('reports')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/report.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Reports</p>
          </div>
        </div>
      </a>
      <!-- menu button Audit Log -->
      <a href="../AdminFE/auditlog.html" ng-if="canShow('auditLog')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/auditlog.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Audit Log</p>
          </div>
        </div>
      </a>
      <!-- menu button Users -->
      <a href="../AdminFE/users.html" ng-if="canShow('users')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/user.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Users</p>
          </div>
        </div>
      </a>
      <!-- menu button Settings -->
      <a href="../AdminFE/settings.html" ng-if="canShow('settings')">
        <div class="slide-bar__MenuButton">
          <div class="MenuButton-left">
            <img src="../Shared/img/common/setting.svg" alt="" class="icon" />
          </div>
          <div class="MenuButton-right">
            <p class="name-menu">Settings</p>
          </div>
        </div>
      </a>
    </div>
    <div class="slide-bar__footer">
      <div class="app-slide-bar">
        <div class="ava">
          <img class="ava" src="../Shared/img/common/ava.svg" alt="" />
        </div>
        <div class="info">
          <p class="name">{{currentUser.fullname}}</p>
          <p class="role">{{currentUser.role}}</p>
        </div>
      </div>
    </div>
  </div>
  <div class="app-layout">
    <div class="top-bar">
      <div class="top-bar__content">
        <div class="top-bar__left" style="visibility: hidden">
          <img src="../Shared/img/common/search.svg" alt="" class="icon" />
          <input class="search" type="text" placeholder="Search by categories name" ng-model="searchCategories" />
        </div>
        <div class="top-bar__right">
          <p class="role">{{currentUser.role}}</p>
          <img src="../Shared/img/common/ava.svg" alt="" class="ava" id="avatar" />
        </div>
      </div>
      <div class="top-bar__info" id="information">
        <div class="info-top">
          <p class="name">{{currentUser.fullname}}</p>
          <p class="email">{{currentUser.email}}</p>
        </div>
        <div class="info-mid">
          <a href="#!">
            <p class="set">Profile Settings</p>
          </a>
        </div>
        <div class="info-bottom">
          <img src="../Shared/img/categories/logout.svg" alt="" class="icon" />
          <a href="../AuthFE/login.html">
            <p class="logout">Logout</p>
          </a>
        </div>
      </div>
    </div>
    <div class="app-layout-content">
      <div class="container-top">
        <div class="container-top--left">
          <h1 class="name-system">GoodsReceipts</h1>
          <p class="desc-system">
            Manage goods receipt records and inventory updates
          </p>
        </div>
        <div class="control add-goodsreceipts" ng-click="openAddReceipt()">
          <img src="../Shared/img/common/plus.svg" alt="" class="icon-control" />
          <p class="name-control">Add GoodsReceipts</p>
        </div>
      </div>
      <div class="container-card">
        <div class="card">
          <p class="name-card">Total GoodReceipts</p>
          <p class="data-card">{{stats.totalReceipts}}</p>
        </div>

        <div class="card">
          <p class="name-card">Total Completed</p>
          <p class="data-card">{{stats.totalCompleted}}</p>
        </div>
        <div class="card">
          <p class="name-card">Total Pending</p>
          <p class="data-card">{{stats.totalPending}}</p>
        </div>
        <div class="card">
          <p class="name-card">Total Processing</p>
          <p class="data-card">{{stats.totalProcessing}}</p>
        </div>
      </div>

      <div class="search-goodreceipts">
        <!-- t√¨m theo kho·∫£ng th·ªùi gian -->
        <div class="search-field">
          <label>From Date:</label>
          <input type="date" ng-model="searchFromDate" class="search" />
        </div>
        <div class="search-field">
          <label>To Date:</label>
          <input type="date" ng-model="searchToDate" class="search" />
        </div>

        <!-- t√¨m theo kho·∫£ng ti·ªÅn -->
        <div class="search-field">
          <label>Min Amount:</label>
          <input type="number" ng-model="searchMinAmount" class="search" placeholder="0" />
        </div>
        <div class="search-field">
          <label>Max Amount:</label>
          <input type="number" ng-model="searchMaxAmount" class="search" placeholder="1000000" />
        </div>

        <!-- t√¨m theo POID -->
        <div class="search-field">
          <label>POID:</label>
          <input type="text" ng-model="searchPOID" class="search" placeholder="Enter POID" />
        </div>
      </div>
      <!-- ph√¢n trang -->
      <div class="pager" ng-if="pager.total>0">
        <div class="pager-info">
          Showing
          {{((pager.page-1)*pager.size)+1}}-{{Math.min(pager.page*pager.size,pager.total)}}
          of {{pager.total}} items
        </div>
        <div class="page-nav">
          <label>
            Page size:
            <select ng-model="pager.size" ng-change="changeSize()">
              <option value="10">10</option>
              <option value="20">20</option>
              <option value="30">30</option>
            </select>
          </label>
          <button class="btn ghost" ng-disable="pager.page === 1" ng-click="go(1)">
            ¬´
          </button>
          <button class="btn ghost" ng-disabled="pager.page === 1" ng-click="go(pager.page-1)">
            Prev
          </button>
          <span class="page-no"></span>
          <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.page+1)">
            Next
          </button>
          <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.pages)">
            ¬ª
          </button>
        </div>
      </div>
      <div class="card-table">
        <div class="table-responsive">
          <table class="table">
            <thead>
              <tr>
                <th class="id">Receipt ID</th>
                <th class="poid">POID</th>
                <th class="date">Receipt Date</th>
                <th class="amount">Total Amount</th>
                <th class="user">User ID</th>
                <th class="batch">Batch No</th>
                <th class="status">Status</th>
                <th class="action txt-right">Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="gr in goodsReceipts">
                <td>{{gr.receiptID}}</td>
                <td>{{gr.poid}}</td>
                <td>{{gr.receiptDate | date:'yyyy-MM-dd'}}</td>
                <td>{{gr.totalAmount | number:2}}ƒë</td>
                <td>{{gr.userID}}</td>
                <td>{{gr.batchNo}}</td>
                <td>{{gr.status}}</td>
                <td class="txt-right">
                  <div class="action-menu">
                    <button class="menu-toggle" ng-click="toggleActionMenu(gr)">
                      ‚öô
                    </button>
                    <ul class="menu-list" ng-show="gr.showMenu">
                      <li ng-click="edit(gr)">‚úé Edit</li>
                      <li ng-click="remove(gr)">üóë Delete</li>
                      <li ng-click="detail(gr)">üîç Detail</li>
                      <li ng-click="exportExcel(gr)">‚¨á Export</li>
                      <li ng-click="payment(gr)">üí∞ Payment</li>
                    </ul>
                  </div>
                </td>
              </tr>
              <tr ng-if="goodsReceipts.length == 0">
                <td colspan="8" class="empty">No Data</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <!-- form -->
      <div class="form">
        <!-- Add Goods Receipt -->
        <div class="form-add" ng-class="{open: showAddReceipt}" ng-click="closeAddReceiptOnOverlay($event)">
          <div class="form-add__content" ng-click="$event.stopPropagation()">
            <h3 class="title">Add New Goods Receipt</h3>
            <p class="desc">Enter receipt and product details</p>

            <form name="frmAddGR" ng-submit="addGoodsReceipt()">
              <!-- Phi·∫øu nh·∫≠p -->
              <label for="poid">POID</label>
              <input type="number" id="poid" required placeholder="Enter POID" ng-model="newReceipt.POID" />

              <label for="userid">User ID</label>
              <input type="number" id="userid" required placeholder="Enter User ID" ng-model="newReceipt.UserID" />

              <!-- Chi ti·∫øt phi·∫øu nh·∫≠p -->
              <h4 class="subtitle">Receipt Details</h4>
              <div ng-repeat="item in newReceiptDetails" class="detail-row">
                <label>Product ID</label>
                <input type="number" ng-model="item.ProductID" required placeholder="Product ID" />

                

                <label>Expiry Date</label>
                <input type="date" ng-model="item.ExpiryDate" />

                <button type="button" class="remove" ng-click="removeDetailRowForNewReceipt($index)">
                  Remove
                </button>
              </div>

              <button type="button" class="add-detail" ng-click="addDetailRowForNewReceipt()">
                + Add Product
              </button>

              <!-- Footer -->
              <div class="dialog-footer">
                <button type="button" class="cancel" ng-click="cancelAddReceipt()">
                  Cancel
                </button>
                <input class="submit" type="submit" value="Add Receipt"
                  ng-disabled="frmAddGR.$invalid || savingAddReceipt" />
              </div>
            </form>
          </div>
        </div>

        <div class="form-edit" ng-class="{open: showEdit}" ng-click="closeEditOnOverlay($event)">
          <div class="form-edit__content" ng-click="$event.stopPropagation()">
            <h3 class="title">Edit Goods Receipt</h3>
            <form name="frmEditGR" ng-submit="updateGoodsReceipt()">
              <!-- ReceiptDate -->
              <label for="date-edit">Receipt Date</label>
              <input type="date" id="date-edit" required ng-model="editingReceipt.ReceiptDate" />

              <!-- UserID -->
              <label for="userid-edit">User ID</label>
              <input type="number" id="userid-edit" required placeholder="Enter User ID"
                ng-model="editingReceipt.UserID" />

              <!-- Footer -->
              <div class="dialog-footer">
                <button type="button" class="cancel" ng-click="cancelEdit()">
                  Cancel
                </button>
                <input class="submit" type="submit" value="Edit Goods Receipt"
                  ng-disabled="frmEditGR.$invalid || savingEdit" />
              </div>
            </form>
          </div>
        </div>
        <div class="form-delete" ng-class="{open: showDelete}" ng-click="closeDeleteOnOverlay($event)">
          <div class="form-delete__content" ng-click="$event.stopPropagation()">
            <h3 class="title">X√°c nh·∫≠n x√≥a phi·∫øu nh·∫≠p</h3>
            <p>
              B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a phi·∫øu nh·∫≠p
              <strong>{{deleting.BatchNo}}</strong> kh√¥ng?
            </p>
            <div class="dialog-footer">
              <button type="button" class="cancel" ng-click="cancelDelete()">
                H·ªßy
              </button>
              <button type="button" class="submit" ng-click="confirmDelete()">
                X√≥a
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Detail Goods Receipt -->
      <div class="form-detail" ng-class="{open: showDetail}" ng-click="closeDetailOnOverlay($event)">
        <div class="form-detail__content" ng-click="$event.stopPropagation()">
          <h3 class="title">
            Goods Receipt Details - {{detailReceipt.BatchNo}}
          </h3>

          <!-- Form nh·∫≠p chi ti·∫øt m·ªõi -->
          <div class="detail-add-form">
            <h4>Th√™m chi ti·∫øt m·ªõi</h4>
            <div class="form-row">
              <label>Product ID:</label>
              <input type="number" ng-model="newDetail.ProductID" required />
            </div>
            
            <div class="form-row">
              <label>Expiry Date:</label>
              <input type="date" ng-model="newDetail.ExpiryDate" />
            </div>
            <button class="add-btn" ng-click="addGoodsReceiptDetail()"
              ng-disabled="savingAddDetail || !newDetail.ProductID">
              <span ng-if="savingAddDetail">Adding...</span>
              <span ng-if="!savingAddDetail">Add Product</span>
            </button>
          </div>

          <!-- B·∫£ng chi ti·∫øt -->
          <table class="detail-table">
            <thead>
              <tr>
                <th>Product ID</th>
                <th>Product Name</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Expiry Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="d in receiptDetails">
                <td>{{d.productID}}</td>
                <td>{{d.productName}}</td>
                <td>{{d.quantity}}</td>
                <td>{{d.unitPrice | currency:"":0}}</td>
                <td>
                  {{d.expiryDate ? (d.expiryDate | date:'yyyy-MM-dd') : '‚Äî'}}
                </td>
                <td>
                  <button class="remove-btn" ng-click="deleteGoodsReceiptDetail(d)">
                    üóë Delete
                  </button>
                </td>
              </tr>
            </tbody>
          </table>

          <div class="dialog-footer">
            <button type="button" class="cancel" ng-click="closeDetail()">
              Close
            </button>
          </div>
        </div>
      </div>

      <!-- ==================== MODAL THANH TO√ÅN NH√Ä CUNG C·∫§P ==================== -->
      <div class="form-payment" ng-class="{open: showPaymentModal}" ng-click="closePaymentModal()">
        <div class="form-payment__content" ng-click="$event.stopPropagation()">
          <h3 class="title">
            Thanh to√°n cho phi·∫øu nh·∫≠p #{{paymentReceipt.ReceiptID}}
          </h3>
          <p class="subtitle">
            Nh√† cung c·∫•p:
            <strong>#{{paymentReceipt.SupplierID || '‚Äî'}}</strong> | POID:
            <strong>{{paymentReceipt.POID}}</strong> | T·ªïng ti·ªÅn:
            <strong>{{paymentReceipt.TotalAmount | number:0}}ƒë</strong>
          </p>

          <!-- B·∫¢NG L·ªäCH S·ª¨ THANH TO√ÅN -->
          <div class="payment-history">
            <h4>L·ªãch s·ª≠ thanh to√°n</h4>
            <table class="detail-table">
              <thead>
                <tr>
                  <th>PaymentID</th>
                  <th>Amount</th>
                  <th>PaymentDate</th>
                  <th>Method</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="p in paymentHistory">
                  <td>{{p.paymentID}}</td>
                  <td class="txt-right">{{p.amount | number:0}}ƒë</td>
                  <td>{{p.paymentDate | date:'dd/MM/yyyy'}}</td>
                  <td>{{p.method}}</td>
                  <td>{{p.description || '‚Äî'}}</td>
                </tr>
                <tr ng-if="!paymentHistory || paymentHistory.length === 0">
                  <td colspan="5" class="empty">Ch∆∞a c√≥ thanh to√°n n√†o</td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- FORM TH√äM THANH TO√ÅN M·ªöI -->
          <div class="add-payment-form">
            <h4>Th√™m thanh to√°n m·ªõi</h4>
            <div class="form-row">
              <label>S·ªë ti·ªÅn thanh to√°n <span class="req">*</span></label>
              <input type="number" ng-model="newPayment.Amount" min="1" placeholder="Nh·∫≠p s·ªë ti·ªÅn" required />
            </div>
            <div class="form-row">
              <label>H√¨nh th·ª©c thanh to√°n <span class="req">*</span></label>
              <select ng-model="newPayment.Method" required>
                <option value="">-- Ch·ªçn h√¨nh th·ª©c --</option>
                <option value="Ti·ªÅn m·∫∑t">Ti·ªÅn m·∫∑t</option>
                <option value="Chuy·ªÉn kho·∫£n">Chuy·ªÉn kho·∫£n</option>
                <option value="Th·∫ª">Th·∫ª</option>
                <option value="N·ª£">Ghi n·ª£</option>
              </select>
            </div>
            <div class="form-row">
              <label>Ghi ch√∫</label>
              <input type="text" ng-model="newPayment.Description"
                placeholder="V√≠ d·ª•: Thanh to√°n l·∫ßn 1, CK Vietcombank..." />
            </div>

            <div class="dialog-footer">
              <button type="button" class="cancel" ng-click="closePaymentModal()">
                ƒê√≥ng
              </button>
              <button type="button" class="submit" ng-click="addPayment()"
                ng-disabled="!newPayment.Amount || !newPayment.Method || savingPayment">
                <span ng-if="!savingPayment">Thanh to√°n</span>
                <span ng-if="savingPayment">ƒêang x·ª≠ l√Ω...</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="../Shared/js/goodsreceipts.js"></script>
</body>

</html>