<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet" />

    <!-- css -->
    <link rel="stylesheet" href="../Shared/css/goodsissues.css" />
    <script src="../Shared/angular/angular.min.js"></script>
    <script src="../Shared/angular/global.js"></script>
    <script src="../Shared/angular/goodsissues.js"></script>
    <script src="../Shared/angular/translation.js"></script>
    <title>GoodsIssues</title>
</head>

<body ng-app="AppRetailPos" ng-controller="goodsissuesCtrl">
    <div class="slide-bar">
        <div class="slide-bar__header">
            <div class="app-slideBar">
                <div class="app-slideBar__left">
                    <img src="../Shared/img/common/wheel.svg" alt="" class="icon" />
                </div>
                <div class="app-slideBar__right">
                    <h1 class="name-app">RetailPro</h1>
                    <p class="title-nameApp">Inventory & POS</p>
                </div>
            </div>
        </div>
        <div class="slide-bar__Content">
            <p class="slide-bar__label">{{ t('NAVIGATION') }}</p>
            <!-- menu button Dashboard -->
            <a href="../AdminFE/dashboard.html" ng-if="canShow('dashboard')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/dashboard.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_DASHBOARD') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button POS -->
            <a href="../AdminFE/pos.html" ng-if="canShow('pos')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/pos.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_POS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Products -->
            <a href="../AdminFE/products.html" ng-if="canShow('products')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/product.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_PRODUCTS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Categories -->
            <a href="../AdminFE/categories.html" ng-if="canShow('categories')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/category.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_CATEGORIES') }}</p>
                    </div>
                </div>
            </a>

            <!-- menu button Promotions -->
            <a href="../AdminFE/promotions.html" ng-if="canShow('promotions')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/promotion.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_PROMOTIONS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Customers -->
            <a href="../AdminFE/customers.html" ng-if="canShow('customers')">
                <div class="slide-bar__MenuButton ">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/customer.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_CUSTOMERS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Suppliers -->
            <a href="../AdminFE/suppliers.html" ng-if="canShow('suppliers')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/supplier.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_SUPPLIERS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Purchase Orders -->
            <a href="../AdminFE/purchaseorders.html" ng-if="canShow('purchaseOrders')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/purchaseorder.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_PURCHASE_ORDERS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button StockCard -->
            <a href="../AdminFE/stockcard.html" ng-if="canShow('stock')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/stock.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_STOCK') }}</p>
                    </div>
                </div>
            </a>

            <!-- menu button Goods Receipts -->
            <a href="../AdminFE/goodsreceipts.html" ng-if="canShow('greceipts')">
                <div class="slide-bar__MenuButton ">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/goodReceipt.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('GOODS_RECEIPTS') }}</p>
                    </div>
                </div>
            </a>

            <!-- menu button Goods Issues -->
            <a href="../AdminFE/goodsissues.html" ng-if="canShow('gissues')">
                <div class="slide-bar__MenuButton slide-bar__MenuButton--active">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/goodIssues.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu-active">{{ t('GOODS_ISSUES') }}</p>
                    </div>
                </div>
            </a>

            <!-- menu button Sales -->
            <a href="../AdminFE/sales.html" ng-if="canShow('sales')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/sales.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_SALES') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Returns -->
            <a href="../AdminFE/returns.html" ng-if="canShow('returns')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/return.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_RETURNS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Payments & Debts -->
            <a href="../AdminFE/payments.html" ng-if="canShow('payments')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/payments.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_PAYMENTS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Reports -->
            <a href="../AdminFE/reports.html" ng-if="canShow('reports')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/report.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_REPORTS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Audit Log -->
            <a href="../AdminFE/auditlog.html" ng-if="canShow('auditLog')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/auditlog.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_AUDIT_LOG') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Users -->
            <a href="../AdminFE/users.html" ng-if="canShow('users')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/user.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_USERS') }}</p>
                    </div>
                </div>
            </a>
            <!-- menu button Settings -->
            <a href="../AdminFE/settings.html" ng-if="canShow('settings')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/setting.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">{{ t('NAV_SETTINGS') }}</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="slide-bar__footer">
            <div class="app-slide-bar">
                <div class="ava">
                    <img class="ava" src="../Shared/img/common/ava.svg" alt="" />
                </div>
                <div class="info">
                    <p class="name">{{currentUser.fullname}}</p>
                    <p class="role">{{currentUser.role}}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="app-layout">
        <div class="top-bar">
            <div class="top-bar__content">
                <div class="top-bar__left" style="visibility: hidden;">
                    <img src="../Shared/img/common/search.svg" alt="" class="icon" />
                    <input class="search" type="text" placeholder="Search by address customer"
                        ng-model="searchAddress" />
                </div>
                <div class="top-bar__right">
                    <p class="role">{{currentUser.role}}</p>
                    <img src="../Shared/img/common/ava.svg" alt="" class="ava" id="avatar" />
                </div>
            </div>
            <div class="top-bar__info" id="information">
                <div class="info-top">
                    <p class="name">{{currentUser.fullname}}</p>
                    <p class="email">{{currentUser.email}}</p>
                </div>
                <div class="info-mid">
                    <a href="#!">
                        <p class="set">{{ t('PROFILE_SETTINGS') }}</p>
                    </a>
                </div>
                <div class="info-bottom">
                    <img src="../Shared/img/categories/logout.svg" alt="" class="icon" />
                    <a href="../AuthFE/login.html">
                        <p class="logout">{{ t('LOGOUT') }}</p>
                    </a>
                </div>
            </div>
        </div>
        <div class="app-layout-content">
            <div class="container-top">
                <div class="container-top--left">
                    <h1 class="name-system">{{ t('GI_TITLE') }}</h1>
                    <p class="desc-system">
                        {{ t('GI_DESC') }}
                    </p>
                </div>

                <div class="control add-goodsissues" ng-click="openAddIssue()">
                    <img src="../Shared/img/common/plus.svg" alt="" class="icon-control" />
                    <p class="name-control">{{ t('ADD_GI') }}</p>
                </div>


            </div>

            <!-- ===== TH·ªêNG K√ä (ch·ªâ 1 √¥) ===== -->
            <div class="container-card">
                <div class="card card--total-issues">
                    <p class="name-card">{{ t('GI_TOTAL') }}</p>
                    <p class="data-card">{{stats.totalIssues}}</p>
                </div>
            </div>
            <!-- ===== T√åM KI·∫æM GOODS ISSUES ===== -->
            <div class="search-goodissues">
                <!-- T·ª´ ng√†y -->
                <div class="search-field">
                    <label>{{ t('GI_FROM_DATE') }}:</label>
                    <input type="date" ng-model="searchFromDate" class="search" />
                </div>

                <!-- ƒê·∫øn ng√†y -->
                <div class="search-field">
                    <label>{{ t('GI_TO_DATE') }}:</label>
                    <input type="date" ng-model="searchToDate" class="search" />
                </div>

                <!-- UserID (thay cho POID) -->
                <div class="search-field">
                    <label>{{ t('GI_USER_ID') }}:</label>
                    <input type="text" ng-model="searchUserID" class="search" placeholder="Enter User ID" />
                </div>
            </div>

            <!-- ph√¢n trang -->
            <div class="pager" ng-if="pager.total>0">
                <div class="pager-info">
                    {{ t('PAGING_SHOWING') }}
                    {{((pager.page-1)*pager.size)+1}}-{{Math.min(pager.page*pager.size,pager.total)}}
                    {{ t('PAGING_OF') }} {{pager.total}} {{ t('PAGING_OF') }}
                </div>
                <div class="page-nav">
                    <label>
                        {{ t('PAGING_PAGE_SIZE') }}:
                        <select ng-model="pager.size" ng-change="changeSize()">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="30">30</option>
                        </select>
                    </label>
                    <button class="btn ghost" ng-disable="pager.page === 1" ng-click="go(1)">
                        ¬´
                    </button>
                    <button class="btn ghost" ng-disabled="pager.page === 1" ng-click="go(pager.page-1)">
                        {{ t('PAGING_PREV') }}
                    </button>
                    <span class="page-no"></span>
                    <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.page+1)">
                        {{ t('PAGING_NEXT') }}
                    </button>
                    <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.pages)">
                        ¬ª
                    </button>
                </div>
            </div>
            <!-- ===== B·∫¢NG HI·ªÇN TH·ªä GOODS ISSUES ===== -->
            <div class="card-table">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="id">{{ t('GI_ID') }}</th>
                                <th class="date">{{ t('GI_DATE') }}</th>
                                <th class="user">{{ t('GI_USER') }}</th>
                                <th class="action txt-right">{{ t('ACTIONS') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="gi in goodsIssues">
                                <td>{{gi.issueID}}</td>
                                <td>{{gi.issueDate | date:'yyyy-MM-dd'}}</td>
                                <td>{{gi.userID}}</td>
                                <td class="txt-right action-cell">
                                    <div class="action-menu">
                                        <button class="menu-toggle" ng-click="toggleActionMenu(gi)">‚öô</button>
                                        <ul class="menu-list" ng-show="gi.showMenu">
                                            <li ng-click="detail(gi)">üîç {{ t('ACTION_DETAIL') }}</li>
                                            <li ng-click="remove(gi)">üóë {{ t('ACTION_DELETE') }}</li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            <tr ng-if="goodsIssues.length == 0">
                                <td colspan="5" class="empty">{{ t('NO_DATA') }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="form">
                <!-- Add Goods Issue -->
                <div class="form-add" ng-class="{open: showAddIssue}" ng-click="closeAddIssueOnOverlay($event)">
                    <div class="form-add__content" ng-click="$event.stopPropagation()">
                        <h3 class="title">{{ t('FORM_ADD_GI_TITLE') }}</h3>
                        <p class="desc">{{ t('FORM_ADD_GI_DESC') }}</p>

                        <form name="frmAddGI" ng-submit="addGoodsIssue()">
                            <!-- Phi·∫øu xu·∫•t -->
                            <label for="userid">{{ t('LABEL_USER_ID') }}</label>
                            <input type="number" id="userid" required placeholder="{{ t('PLACEHOLDER_USER_ID') }}"
                                ng-model="newIssue.UserID" />

                            <!-- Chi ti·∫øt phi·∫øu xu·∫•t -->
                            <h4 class="subtitle">{{ t('LABEL_ISSUE_DETAILS') }}</h4>
                            <div ng-repeat="item in newIssueDetails" class="detail-row">
                                <label>{{ t('LABEL_PRODUCT_ID') }}</label>
                                <input type="number" ng-model="item.ProductID" required placeholder="{{ t('LABEL_PRODUCT_ID') }}" />

                                <label>{{ t('LABEL_QUANTITY') }}</label>
                                <input type="number" ng-model="item.Quantity" required placeholder="{{ t('LABEL_QUANTITY') }}" min="1" />

                                <button type="button" class="remove"
                                    ng-click="removeDetailRowForNewIssue($index)">{{ t('BTN_REMOVE') }}</button>
                            </div>

                            <button type="button" class="add-detail" ng-click="addDetailRowForNewIssue()">+ {{ t('BTN_ADD_PRODUCT') }}</button>

                            <!-- Footer -->
                            <div class="dialog-footer">
                                <button type="button" class="cancel" ng-click="cancelAddIssue()"> {{ t('BTN_CANCEL') }}</button>
                                <input class="submit" type="submit" value="{{ t('BTN_ADD_ISSUE') }}"
                                    ng-disabled="frmAddGI.$invalid || savingAddIssue || newIssueDetails.length === 0" />
                            </div>
                        </form>
                    </div>
                </div>
                <!-- Modal Delete Goods Issue -->
                <div class="form-delete" ng-class="{open: showDeleteGI}" ng-click="closeDeleteGIOnOverlay($event)">
                    <div class="form-delete__content" ng-click="$event.stopPropagation()">
                        <h3 class="title">{{ t('FORM_DELETE_GI_TITLE') }}</h3>

                        <p class="desc">
                             {{ t('FORM_DELETE_GI_DESC') }}
                            <strong>{{ deletingGI.GoodsIssueID }}</strong>
                            ng√†y <strong>{{ deletingGI.Date | date:'dd/MM/yyyy' }}</strong>?
                        </p>

                        <div class="dialog-footer">
                            <button type="button" class="cancel" ng-click="cancelDeleteGI()">{{ t('BTN_CANCEL') }}</button>
                            <button type="button" class="submit danger" ng-click="confirmDeleteGI()"
                                ng-disabled="savingDeleteGI">
                                 {{ t('BTN_DELETE_GI') }}
                            </button>
                        </div>
                    </div>
                </div>



            </div>

            <!-- ==================== FORM DETAIL GOODS ISSUES ==================== -->
            <div class="form-detail" ng-class="{open: showDetailIssue}" ng-click="closeDetailIssueOnOverlay($event)">
                <div class="form-detail__content" ng-click="$event.stopPropagation()">
                    <h3 class="title"> {{ t('FORM_GI_DETAIL_TITLE') }}  - ID: {{detailIssue.IssueID}} ({{detailIssue.IssueDate |
                        date:'dd/MM/yyyy'}})</h3>
                    <p class="subtitle"> {{ t('GI_DETAIL_SUB_USER') }}: {{detailIssue.UserID}} | Total Amount: {{detailIssue.TotalAmount |
                        number:0}}ƒë</p>

                    <!-- Form th√™m chi ti·∫øt m·ªõi -->
                    <!-- Form th√™m s·∫£n ph·∫©m trong Detail -->
                    <div class="detail-add-form">
                        <h4>{{ t('DETAIL_ADD_TITLE') }}</h4>
                        <div class="form-row">
                            <label>{{ t('DETAIL_ADD_PRODUCT_ID') }}:</label>
                            <input type="number" ng-model="newDetail.ProductID" placeholder="{{ t('DETAIL_ADD_PRODUCT_ID') }}"
                                required />
                        </div>
                        <div class="form-row">
                            <label>{{ t('DETAIL_ADD_QTY') }}:</label>
                            <input type="number" min="1" ng-model="newDetail.Quantity" placeholder="{{ t('DETAIL_ADD_QTY') }}"
                                required />
                        </div>
                        <button class="add-btn" ng-click="addGoodsIssueDetail()"
                            ng-disabled="savingAddDetail || !newDetail.ProductID || !newDetail.Quantity || !newDetail.UnitPrice">
                            <span ng-if="savingAddDetail">{{ t('BTN_ADDING_DETAIL') }}</span>
                            <span ng-if="!savingAddDetail">{{ t('BTN_ADD_DETAIL') }}</span>
                        </button>
                    </div>

                    <!-- B·∫¢NG CHI TI·∫æT PHI·∫æU XU·∫§T ‚Äì CH·ªà 5 C·ªòT -->
                    <table class="detail-table">
                        <thead>
                            <tr>
                                <th>{{ t('GID_PRODUCT_ID') }}</th>
                                <th>{{ t('GID_PRODUCT_NAME') }}</th>
                                <th>{{ t('GID_QTY') }}</th>
                                <th class="action-col">{{ t('GID_ACTIONS') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="d in issueDetails">
                                <td>{{d.ProductID}}</td>
                                <td>{{d.ProductName || '‚Äî'}}</td>
                                <td class="txt-right">{{d.Quantity | number:0}}</td>
                                <td class="action-col">
                                    <button class="remove-btn" ng-click="deleteGoodsIssueDetail(d)"
                                        ng-disabled="deletingDetail" title="X√≥a s·∫£n ph·∫©m n√†y kh·ªèi phi·∫øu xu·∫•t">
                                        <span ng-if="!deletingDetail">  {{ t('BTN_DELETE_DETAIL') }}</span>
                                        <span ng-if="deletingDetail">  {{ t('BTN_DELETE_DETAIL1') }}</span>
                                    </button>
                                </td>
                            </tr>
                            <tr ng-if="!issueDetails || issueDetails.length === 0">
                                <td colspan="5" style="text-align:center; color:#999; padding:20px; font-style:italic;">
                                    {{ t('NO_DETAIL_ITEMS') }}
                                </td>
                            </tr>
                        </tbody>
                    </table>



                    <div class="dialog-footer">
                        <button type="button" class="cancel" ng-click="closeDetailIssue()">{{ t('BTN_CLOSE') }}</button>
                    </div>
                </div>
            </div>
        </div>




    </div>

    </div>
    <script src="../Shared/js/goodsissues.js"></script>
</body>

</html>