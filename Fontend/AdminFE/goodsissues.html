<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        rel="stylesheet" />

    <!-- css -->
    <link rel="stylesheet" href="../Shared/css/goodsissues.css" />
    <script src="../Shared/angular/angular.min.js"></script>
    <script src="../Shared/angular/global.js"></script>
    <script src="../Shared/angular/goodsissues.js"></script>
    <title>GoodsIssues</title>
</head>

<body ng-app="AppRetailPos" ng-controller="goodsissuesCtrl">
    <div class="slide-bar">
        <div class="slide-bar__header">
            <div class="app-slideBar">
                <div class="app-slideBar__left">
                    <img src="../Shared/img/common/wheel.svg" alt="" class="icon" />
                </div>
                <div class="app-slideBar__right">
                    <h1 class="name-app">RetailPro</h1>
                    <p class="title-nameApp">Inventory & POS</p>
                </div>
            </div>
        </div>
        <div class="slide-bar__Content">
            <p class="slide-bar__label">Navigation</p>
            <!-- menu button Dashboard -->
            <a href="../AdminFE/dashboard.html" ng-if="canShow('dashboard')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/dashboard.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Dashboard</p>
                    </div>
                </div>
            </a>
            <!-- menu button POS -->
            <a href="../AdminFE/pos.html" ng-if="canShow('pos')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/pos.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">POS</p>
                    </div>
                </div>
            </a>
            <!-- menu button Products -->
            <a href="../AdminFE/products.html" ng-if="canShow('products')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/product.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Products</p>
                    </div>
                </div>
            </a>
            <!-- menu button Categories -->
            <a href="../AdminFE/categories.html" ng-if="canShow('categories')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/category.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Categories</p>
                    </div>
                </div>
            </a>

            <!-- menu button Promotions -->
            <a href="../AdminFE/promotions.html" ng-if="canShow('promotions')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/promotion.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Promotions</p>
                    </div>
                </div>
            </a>
            <!-- menu button Customers -->
            <a href="../AdminFE/customers.html" ng-if="canShow('customers')">
                <div class="slide-bar__MenuButton ">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/customer.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu-active">Customers</p>
                    </div>
                </div>
            </a>
            <!-- menu button Suppliers -->
            <a href="../AdminFE/suppliers.html" ng-if="canShow('suppliers')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/supplier.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Suppliers</p>
                    </div>
                </div>
            </a>
            <!-- menu button Purchase Orders -->
            <a href="../AdminFE/purchaseorders.html" ng-if="canShow('purchaseOrders')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/purchaseorder.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Purchase Orders</p>
                    </div>
                </div>
            </a>
            <!-- menu button StockCard -->
            <a href="../AdminFE/stockcard.html" ng-if="canShow('stock')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/stock.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Stock Management</p>
                    </div>
                </div>
            </a>

            <!-- menu button Goods Receipts -->
            <a href="../AdminFE/goodsreceipts.html" ng-if="canShow('greceipts')">
                <div class="slide-bar__MenuButton slide-bar__MenuButton--active">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/goodReceipt.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Goods Receipts</p>
                    </div>
                </div>
            </a>

            <!-- menu button Goods Issues -->
            <a href="../AdminFE/goodsissues.html" ng-if="canShow('gissues')">
                <div class="slide-bar__MenuButton ">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/goodIssues.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Goods Issues</p>
                    </div>
                </div>
            </a>

            <!-- menu button Sales -->
            <a href="../AdminFE/sales.html" ng-if="canShow('sales')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/sales.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Sales</p>
                    </div>
                </div>
            </a>
            <!-- menu button Returns -->
            <a href="../AdminFE/returns.html" ng-if="canShow('returns')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/return.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Returns</p>
                    </div>
                </div>
            </a>
            <!-- menu button Payments & Debts -->
            <a href="../AdminFE/payments.html" ng-if="canShow('payments')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/payments.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Payments & Debts</p>
                    </div>
                </div>
            </a>
            <!-- menu button Reports -->
            <a href="../AdminFE/reports.html" ng-if="canShow('reports')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/report.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Reports</p>
                    </div>
                </div>
            </a>
            <!-- menu button Audit Log -->
            <a href="../AdminFE/auditlog.html" ng-if="canShow('auditLog')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/auditlog.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Audit Log</p>
                    </div>
                </div>
            </a>
            <!-- menu button Users -->
            <a href="../AdminFE/users.html" ng-if="canShow('users')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/user.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Users</p>
                    </div>
                </div>
            </a>
            <!-- menu button Settings -->
            <a href="../AdminFE/settings.html" ng-if="canShow('settings')">
                <div class="slide-bar__MenuButton">
                    <div class="MenuButton-left">
                        <img src="../Shared/img/common/setting.svg" alt="" class="icon" />
                    </div>
                    <div class="MenuButton-right">
                        <p class="name-menu">Settings</p>
                    </div>
                </div>
            </a>
        </div>
        <div class="slide-bar__footer">
            <div class="app-slide-bar">
                <div class="ava">
                    <img class="ava" src="../Shared/img/common/ava.svg" alt="" />
                </div>
                <div class="info">
                    <p class="name">{{currentUser.fullname}}</p>
                    <p class="role">{{currentUser.role}}</p>
                </div>
            </div>
        </div>
    </div>
    <div class="app-layout">
        <div class="top-bar">
            <div class="top-bar__content">
                <div class="top-bar__left">
                    <img src="../Shared/img/common/search.svg" alt="" class="icon" />
                    <input class="search" type="text" placeholder="Search by address customer"
                        ng-model="searchAddress" />
                </div>
                <div class="top-bar__right">
                    <p class="role">admin</p>
                    <img src="../Shared/img/common/ava.svg" alt="" class="ava" id="avatar" />
                </div>
            </div>
            <div class="top-bar__info" id="information">
                <div class="info-top">
                    <p class="name">John Doe</p>
                    <p class="email">john@company.com</p>
                </div>
                <div class="info-mid">
                    <a href="#!">
                        <p class="set">Profile Settings</p>
                    </a>
                </div>
                <div class="info-bottom">
                    <img src="../Shared/img/categories/logout.svg" alt="" class="icon" />
                    <a href="../AuthFE/login.html">
                        <p class="logout">Logout</p>
                    </a>
                </div>
            </div>
        </div>
        <div class="app-layout-content">
            <div class="container-top">
                <div class="container-top--left">
                    <h1 class="name-system">GoodsIssues</h1>
                    <p class="desc-system">
                        Manage warehouse outbound transactions and inventory issues
                    </p>
                </div>

                <div class="control add-goodsissues" ng-click="openAddIssue()">
                    <img src="../Shared/img/common/plus.svg" alt="" class="icon-control" />
                    <p class="name-control">Add GoodsIssues </p>
                </div>


            </div>

            <!-- ===== TH·ªêNG K√ä (ch·ªâ 1 √¥) ===== -->
            <div class="container-card">
                <div class="card card--total-issues">
                    <p class="name-card">Total Goods Issues</p>
                    <p class="data-card">{{stats.totalIssues}}</p>
                </div>
            </div>
            <!-- ===== T√åM KI·∫æM GOODS ISSUES ===== -->
            <div class="search-goodissues">
                <!-- T·ª´ ng√†y -->
                <div class="search-field">
                    <label>From Date:</label>
                    <input type="date" ng-model="searchFromDate" class="search" />
                </div>

                <!-- ƒê·∫øn ng√†y -->
                <div class="search-field">
                    <label>To Date:</label>
                    <input type="date" ng-model="searchToDate" class="search" />
                </div>

                <!-- S·ªë ti·ªÅn nh·ªè nh·∫•t -->
                <div class="search-field">
                    <label>Min Amount:</label>
                    <input type="number" ng-model="searchMinAmount" class="search" placeholder="0" />
                </div>

                <!-- S·ªë ti·ªÅn l·ªõn nh·∫•t -->
                <div class="search-field">
                    <label>Max Amount:</label>
                    <input type="number" ng-model="searchMaxAmount" class="search" placeholder="1000000" />
                </div>

                <!-- UserID (thay cho POID) -->
                <div class="search-field">
                    <label>User ID:</label>
                    <input type="text" ng-model="searchUserID" class="search" placeholder="Enter User ID" />
                </div>
            </div>

            <!-- ph√¢n trang -->
            <div class="pager" ng-if="pager.total>0">
                <div class="pager-info">
                    Showing
                    {{((pager.page-1)*pager.size)+1}}-{{Math.min(pager.page*pager.size,pager.total)}}
                    of {{pager.total}} items
                </div>
                <div class="page-nav">
                    <label>
                        Page size:
                        <select ng-model="pager.size" ng-change="changeSize()">
                            <option value="10">10</option>
                            <option value="20">20</option>
                            <option value="30">30</option>
                        </select>
                    </label>
                    <button class="btn ghost" ng-disable="pager.page === 1" ng-click="go(1)">
                        ¬´
                    </button>
                    <button class="btn ghost" ng-disabled="pager.page === 1" ng-click="go(pager.page-1)">
                        Prev
                    </button>
                    <span class="page-no"></span>
                    <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.page+1)">
                        Next
                    </button>
                    <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.pages)">
                        ¬ª
                    </button>
                </div>
            </div>
            <!-- ===== B·∫¢NG HI·ªÇN TH·ªä GOODS ISSUES ===== -->
            <div class="card-table">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th class="id">Issue ID</th>
                                <th class="date">Issue Date</th>
                                <th class="user">User ID</th>
                                <th class="amount">Total Amount</th>
                                <th class="action txt-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="gi in goodsIssues">
                                <td>{{gi.issueID}}</td>
                                <td>{{gi.issueDate | date:'yyyy-MM-dd'}}</td>
                                <td>{{gi.userID}}</td>
                                <td class="txt-right">{{gi.totalAmount | number:2}}ƒë</td>
                                <td class="txt-right action-cell">
                                    <div class="action-menu">
                                        <button class="menu-toggle" ng-click="toggleActionMenu(gi)">‚öô</button>
                                        <ul class="menu-list" ng-show="gi.showMenu">
                                            <li ng-click="detail(gi)">üîç Detail</li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            <tr ng-if="goodsIssues.length == 0">
                                <td colspan="5" class="empty">No Data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="form">
                <!-- Add Goods Issue -->
                <div class="form-add" ng-class="{open: showAddIssue}" ng-click="closeAddIssueOnOverlay($event)">
                    <div class="form-add__content" ng-click="$event.stopPropagation()">
                        <h3 class="title">Add New Goods Issue</h3>
                        <p class="desc">Enter issue details and products to issue</p>

                        <form name="frmAddGI" ng-submit="addGoodsIssue()">
                            <!-- Phi·∫øu xu·∫•t -->
                            <label for="userid">User ID</label>
                            <input type="number" id="userid" required placeholder="Enter User ID"
                                ng-model="newIssue.UserID" />

                            <!-- Chi ti·∫øt phi·∫øu xu·∫•t -->
                            <h4 class="subtitle">Issue Details</h4>
                            <div ng-repeat="item in newIssueDetails" class="detail-row">
                                <label>Product ID</label>
                                <input type="number" ng-model="item.ProductID" required placeholder="Product ID" />

                                <label>Quantity</label>
                                <input type="number" ng-model="item.Quantity" required placeholder="Quantity" min="1" />

                                <label>Unit Price</label>
                                <input type="number" ng-model="item.UnitPrice" required placeholder="Unit Price" min="0"
                                    step="0.01" />

                                <button type="button" class="remove"
                                    ng-click="removeDetailRowForNewIssue($index)">Remove</button>
                            </div>

                            <button type="button" class="add-detail" ng-click="addDetailRowForNewIssue()">+ Add
                                Product</button>

                            <!-- Footer -->
                            <div class="dialog-footer">
                                <button type="button" class="cancel" ng-click="cancelAddIssue()">Cancel</button>
                                <input class="submit" type="submit" value="Add Issue"
                                    ng-disabled="frmAddGI.$invalid || savingAddIssue || newIssueDetails.length === 0" />
                            </div>
                        </form>
                    </div>
                </div>


            </div>

            <!-- ==================== FORM DETAIL GOODS ISSUES ==================== -->
            <div class="form-detail" ng-class="{open: showDetailIssue}" ng-click="closeDetailIssueOnOverlay($event)">
                <div class="form-detail__content" ng-click="$event.stopPropagation()">
                    <h3 class="title">Goods Issue Details - ID: {{detailIssue.IssueID}} ({{detailIssue.IssueDate |
                        date:'dd/MM/yyyy'}})</h3>
                    <p class="subtitle">User ID: {{detailIssue.UserID}} | Total Amount: {{detailIssue.TotalAmount |
                        number:0}}ƒë</p>

                    <!-- Form th√™m chi ti·∫øt m·ªõi -->
                    <!-- Form th√™m s·∫£n ph·∫©m trong Detail -->
                    <div class="detail-add-form">
                        <h4>Th√™m s·∫£n ph·∫©m xu·∫•t kho</h4>
                        <div class="form-row">
                            <label>Product ID:</label>
                            <input type="number" ng-model="newDetail.ProductID" placeholder="Nh·∫≠p m√£ s·∫£n ph·∫©m"
                                required />
                        </div>
                        <div class="form-row">
                            <label>Quantity:</label>
                            <input type="number" min="1" ng-model="newDetail.Quantity" placeholder="S·ªë l∆∞·ª£ng"
                                required />
                        </div>
                        <div class="form-row">
                            <label>Unit Price:</label>
                            <input type="number" step="0.01" ng-model="newDetail.UnitPrice" placeholder="ƒê∆°n gi√°"
                                required />
                        </div>
                        <button class="add-btn" ng-click="addGoodsIssueDetail()"
                            ng-disabled="savingAddDetail || !newDetail.ProductID || !newDetail.Quantity || !newDetail.UnitPrice">
                            <span ng-if="savingAddDetail">Adding...</span>
                            <span ng-if="!savingAddDetail">Add Product</span>
                        </button>
                    </div>

                    <!-- B·∫¢NG CHI TI·∫æT PHI·∫æU XU·∫§T ‚Äì CH·ªà 5 C·ªòT -->
                    <table class="detail-table">
                        <thead>
                            <tr>
                                <th>Product ID</th>
                                <th>Product Name</th>
                                <th>Quantity</th>
                                <th>Unit Price</th>
                                <th class="action-col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="d in issueDetails">
                                <td>{{d.ProductID}}</td>
                                <td>{{d.ProductName || '‚Äî'}}</td>
                                <td class="txt-right">{{d.Quantity | number:0}}</td>
                                <td class="txt-right">{{d.UnitPrice | number:0}}ƒë</td>
                                <td class="action-col">
                                    <button class="remove-btn" ng-click="deleteGoodsIssueDetail(d)"
                                        ng-disabled="deletingDetail" title="X√≥a s·∫£n ph·∫©m n√†y kh·ªèi phi·∫øu xu·∫•t">
                                        <span ng-if="!deletingDetail">Delete</span>
                                        <span ng-if="deletingDetail">Deleting...</span>
                                    </button>
                                </td>
                            </tr>
                            <tr ng-if="!issueDetails || issueDetails.length === 0">
                                <td colspan="5" style="text-align:center; color:#999; padding:20px; font-style:italic;">
                                    Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o ƒë∆∞·ª£c xu·∫•t
                                </td>
                            </tr>
                        </tbody>
                    </table>



                    <div class="dialog-footer">
                        <button type="button" class="cancel" ng-click="closeDetailIssue()">Close</button>
                    </div>
                </div>
            </div>
        </div>




    </div>

    </div>

</body>

</html>