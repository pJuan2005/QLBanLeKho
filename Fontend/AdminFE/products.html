<!DOCTYPE html>
<html lang="en" ng-app="AppRetailPos">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet" />

  <!-- css -->
  <link rel="stylesheet" href="../Shared/css/product.css" />

  <!-- Angular -->
  <script src="../Shared/angular/angular.min.js"></script>
  <script src="../Shared/angular/global.js"></script>
  <script src="../Shared/angular/product.js"></script>

  <!-- jQuery (má»™t báº£n duy nháº¥t) -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- ExcelJS + FileSaver (xuáº¥t Excel) -->
  <script src="https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

  <!-- (TÃ¹y chá»n) Select2 â€“ náº¿u tháº­t sá»± cáº§n -->
  <!--
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  -->

  <title>Products</title>
</head>

<body ng-controller="productCtrl">
  <div class="app-content">

    <!-- SIDEBAR -->
    <div class="slide-bar">
      <div class="slide-bar__header">
        <div class="app-slideBar">
          <div class="app-slideBar__left">
            <img src="../Shared/img/common/wheel.svg" alt="" class="icon" />
          </div>
          <div class="app-slideBar__right">
            <h1 class="name-app">RetailPro</h1>
            <p class="title-nameApp">Inventory & POS</p>
          </div>
        </div>
      </div>

      <div class="slide-bar__Content">
        <p class="slide-bar__label">Navigation</p>

        <!-- Má»—i anchor pháº£i Bá»ŒC menu button; khÃ´ng Ä‘á»ƒ </a> láº¡c chá»— -->
        <a href="../AdminFE/dashboard.html" ng-if="canShow('dashboard')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/dashboard.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Dashboard</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/pos.html" ng-if="canShow('pos')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/pos.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">POS</p>
            </div>
          </div>
        </a>

        <!-- ÄÃƒ Äá»”I TÃŠN FILE: product.html -> products.html -->
        <a href="../AdminFE/products.html" ng-if="canShow('products')">
          <div class="slide-bar__MenuButton slide-bar__MenuButton--active">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/product.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu-active">Products</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/categories.html" ng-if="canShow('categories')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/category.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Categories</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/customers.html" ng-if="canShow('customers')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/customer.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Customers</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/suppliers.html" ng-if="canShow('suppliers')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/supplier.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Suppliers</p>
            </div>
          </div>
        </a>

        <!-- ÄÃƒ Äá»”I TÃŠN FILE: purchaseorder.html -> purchaseorders.html -->
        <a href="../AdminFE/purchaseorders.html" ng-if="canShow('purchaseOrders')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/purchaseorder.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Purchase Orders</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/stockcard.html" ng-if="canShow('stock')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/stock.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Stock Management</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/sales.html" ng-if="canShow('sales')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/sales.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Sales</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/returns.html" ng-if="canShow('returns')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/return.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Returns</p>
            </div>
          </div>
        </a>

        <!-- SAI LINK trong báº£n cÅ©: trá» nháº§m returns.html. Sá»­a vá» payments.html -->
        <a href="../AdminFE/payments.html" ng-if="canShow('returns')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/payments.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Payments & Debts</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/reports.html" ng-if="canShow('reports')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/report.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Reports</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/auditlog.html" ng-if="canShow('auditLog')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/auditlog.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Audit Log</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/users.html" ng-if="canShow('users')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/user.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Users</p>
            </div>
          </div>
        </a>

        <a href="../AdminFE/settings.html" ng-if="canShow('settings')">
          <div class="slide-bar__MenuButton">
            <div class="MenuButton-left">
              <img src="../Shared/img/common/setting.svg" alt="" class="icon" />
            </div>
            <div class="MenuButton-right">
              <p class="name-menu">Settings</p>
            </div>
          </div>
        </a>
      </div>

      <div class="slide-bar__footer">
        <div class="app-slide-bar">
          <div class="ava">
            <img class="ava" src="../Shared/img/common/ava.svg" alt="" />
          </div>
          <div class="info">
            <p class="name">{{currentUser.fullname}}</p>
            <p class="role">{{currentUser.role}}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- MAIN -->
    <div class="app-layout">
      <div class="top-bar">
        <div class="top-bar__content">
          <div class="top-bar__left">
            <img src="../Shared/img/common/search.svg" alt="" class="icon" />
            <input class="search" type="text" placeholder="Search by product name" ng-model="searchProduct" />
          </div>
          <div class="top-bar__right">
            <p class="role">admin</p>
            <img src="../Shared/img/common/ava.svg" alt="" class="ava" id="avatar" />
          </div>
        </div>

        <div class="top-bar__info" id="information">
          <div class="info-top">
            <p class="name">John Doe</p>
            <p class="email">john@company.com</p>
          </div>
          <div class="info-mid">
            <a href="#!"><p class="set">Profile Settings</p></a>
          </div>
          <div class="info-bottom">
            <img src="" alt="" class="icon" />
            <a href="../AuthFE/login.html"><p class="logout">Logout</p></a>
          </div>
        </div>
      </div>

      <div class="app-layout-content">
        <h1 class="name-menu">Product</h1>
        <p class="desc">Manage product inventory and pricing</p>

        <div class="display-container">
          <div class="total farme">
            <p class="name-display">Total Products</p>
            <p class="data">{{stats.total}}</p>
          </div>
          <div class="avg farme">
            <p class="name-display">In stock</p>
            <p class="data">{{stats.instock}}</p>
          </div>
          <div class="most-common farme">
            <p class="name-display">Out of Stock</p>
            <p class="data">{{stats.outstock}}</p>
          </div>
        </div>

        <div class="control">
          <div class="control-left">
            <img src="../Shared/img/common/search.svg" alt="" class="icon" />
            <input class="search" type="text" placeholder="Search by SKU" ng-model="searchSKU" />
          </div>

          <!-- pager -->
          <div class="pager" ng-if="pager.total>0">
            <div class="pager-info">
              Showing {{((pager.page-1)*pager.size)+1}}-{{Math.min(pager.page*pager.size,pager.total)}} of {{pager.total}} items
            </div>
            <div class="page-nav">
              <label>
                Page size:
                <select ng-model="pager.size" ng-change="changeSize()">
                  <option value="0">ALL</option>
                  <option value="10">10</option>
                  <option value="20">20</option>
                  <option value="30">30</option>
                </select>
              </label>
              <button class="btn ghost" ng-disabled="pager.page === 1" ng-click="go(1)">Â«</button>
              <button class="btn ghost" ng-disabled="pager.page === 1" ng-click="go(pager.page-1)">Prev</button>
              <span class="page-no"></span>
              <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.page+1)">Next</button>
              <button class="btn ghost" ng-disabled="pager.page >= pager.pages" ng-click="go(pager.pages)">Â»</button>
            </div>
          </div>

          <div class="control-right">
            <!-- Import (áº©n input, click icon Ä‘á»ƒ má»Ÿ) -->
            <div class="import" ng-click="triggerImportFile()">
              <img src="../Shared/img/common/import.svg" alt="" class="icon" />
            </div>
            <input type="file" id="fileImport" accept=".xlsx,.xls" style="display:none" onchange="angular.element(this).scope().handleImportFile(this)" />

            <!-- Export -->
            <div class="export" ng-click="exportExcel()">
              <img src="../Shared/img/common/export.svg" alt="" class="icon" />
            </div>

            <!-- Add -->
            <div class="add" id="btnOpenAdd">
              <img src="../Shared/img/common/plus.svg" alt="" class="plus" />
              <p class="add-product">Add Product</p>
            </div>
          </div>
        </div>

        <!-- table -->
        <div class="card">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th class="id">Product ID</th>
                  <th class="name">Product Name</th>
                  <th class="sku">SKU</th>
                  <th class="barcode">Barcode</th>
                  <th class="categoryid">CategoryID</th>
                  <th class="unitprice">Price</th>
                  <th class="unit">Unit</th>
                  <th class="minstock">MinStock</th>
                  <th class="qty">Quantity</th>
                  <th class="vat">VAT Rate (%)</th>
                  <th class="status">Status</th>
                  <th class="img">Image</th>
                  <th class="action txt-right">Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr ng-repeat="p in products" style="font-weight:600;">
                  <td>{{p.productID}}</td>
                  <td>{{p.productName}}</td>
                  <td>{{p.sku}}</td>
                  <td>{{p.barcode}}</td>
                  <td><span class="stock">{{p.categoryID}}</span></td>
                  <td>{{p.unitPrice}}</td>
                  <td>{{p.unit}}</td>
                  <td>{{p.minStock}}</td>
                  <td>
                    <span class="stock" ng-class="p.quantity > p.minStock ? 'good' : 'low'">{{p.quantity}}</span>
                  </td>
                  <td>{{p.vatRate}}%</td>
                  <td>
                    <span class="stock" ng-class="p.status === 'Active' ? 'good' : 'low'">{{p.status}}</span>
                  </td>
                  <td style="text-align:center;">
                    <img ng-if="p.image"
                         ng-src="{{p.image}}"
                         alt="Product Image"
                         ng-click="openImageModal(p.image)"
                         style="width:60px;height:60px;border-radius:6px;object-fit:contain;border:1px solid #ddd;background-color:#f8f8f8;padding:2px;cursor:zoom-in;"
                         onerror="this.src='assets/img/no-image.png'; this.onerror=null;" />
                    <span ng-if="!p.image" style="color:#999;">No image</span>
                  </td>
                  <td class="txt-right">
                    <button class="link" ng-click="edit(p)">âœŽ Edit</button>
                    <button class="link danger" ng-click="remove(p)">ðŸ—‘ Delete</button>
                  </td>
                </tr>

                <tr ng-if="!products || products.length === 0">
                  <td colspan="13" class="empty">No Data</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- ========== IMAGE VIEWER MODAL ========== -->
        <div class="image-viewer" ng-if="showImageModal" ng-click="closeImageModal($event)">
          <div class="image-viewer__content">
            <img ng-src="{{selectedImage}}" alt="Full Image">
          </div>
        </div>

        <!-- FORM ADD -->
        <div class="form-add">
          <div class="form-add__content">
            <h3 class="title">Add Product</h3>
            <p class="desc">Create a new product</p>

            <form name="frmAdd" ng-submit="add()">
              <div>
                <label for="name-add">Product Name *</label>
                <input id="name-add" type="text" required placeholder="Enter product name" ng-model="newProduct.productName" />

                <label for="sku-add">SKU*</label>
                <input id="sku-add" type="text" required placeholder="Enter SKU" ng-model="newProduct.sku" />

                <label for="barcode-add">Barcode*</label>
                <input id="barcode-add" type="text" required placeholder="Enter Barcode" ng-model="newProduct.barcode" />

                <label for="unitprice-add">Price*</label>
                <input id="unitprice-add" type="number" min="0" step="1000" placeholder="Enter price" ng-model="newProduct.unitPrice" />

                <label for="unit-add">Unit</label>
                <input id="unit-add" type="text" placeholder="Enter Unit" ng-model="newProduct.unit" />

                <label for="vat-add">VAT Rate(%)</label>
                <input id="vat-add" type="number" placeholder="0.00" ng-model="newProduct.vatRate" min="0" step="0.01" />
                <label class="standard">Standard VAT rates: 10% (most products), 9% (special items)</label>
              </div>

              <div>
                <label for="categoryid-add">CategoryName*</label>
                <select id="categoryid-add" required ng-model="newProduct.categoryID" ng-options="c.categoryID as c.categoryName for c in categories">
                  <option value="">Select Category</option>
                </select>

                <label for="minstock-add">MinStock</label>
                <input id="minstock-add" type="number" placeholder="Enter MinStock" ng-model="newProduct.minStock" min="0" step="1" />

                <label for="quantity-add">Quantity</label>
                <input id="quantity-add" type="number" placeholder="Enter Quantity" ng-model="newProduct.quantity" min="0" step="1" />

                <label for="status-add">Status</label>
                <select id="status-add" ng-model="newProduct.status">
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                </select>

                <label for="imageInputAdd">Image</label>
                <input id="imageInputAdd" type="file" accept="image/*" onchange="angular.element(this).scope().previewImageAdd(this)">
                <img id="previewAdd" style="width:60px;height:60px;margin-top:5px;border-radius:6px;" ng-if="newProduct.image" ng-src="{{newProduct.image}}" />
              </div>

              <div class="dialog-footer">
                <button type="button" class="cancel">Cancel</button>
                <input class="submit" type="submit" value="Add Product" ng-disabled="frmAdd.$invalid || savingAdd" />
              </div>
            </form>
          </div>
        </div>

        <!-- FORM EDIT -->
        <div class="form-edit">
          <div class="form-edit__content">
            <h3 class="title">Edit Product</h3>
            <p class="desc">Update product information</p>

            <form name="frmEdit" ng-submit="updateProduct()">
              <div>
                <label for="name-edit">Product Name *</label>
                <input id="name-edit" type="text" required placeholder="Enter product name" ng-model="editingProduct.productName" />

                <label for="sku-edit">SKU*</label>
                <input id="sku-edit" type="text" required placeholder="Enter SKU" ng-model="editingProduct.sku" />

                <label for="barcode-edit">Barcode*</label>
                <input id="barcode-edit" type="text" required placeholder="Enter Barcode" ng-model="editingProduct.barcode" />

                <label for="unitprice-edit">Price*</label>
                <input id="unitprice-edit" type="number" min="0" step="1000" placeholder="Enter price" ng-model="editingProduct.unitPrice" />

                <label for="unit-edit">Unit</label>
                <input id="unit-edit" type="text" placeholder="Enter Unit" ng-model="editingProduct.unit" />

                <label for="vat-edit">VAT Rate(%)</label>
                <input id="vat-edit" type="number" placeholder="0.00" ng-model="editingProduct.vatRate" min="0" step="0.01" />
                <label class="standard">Standard VAT rates: 10% (most products), 9% (special items)</label>
              </div>

              <div>
                <label for="categoryid-edit">CategoryName*</label>
                <select id="categoryid-edit" ng-model="editingProduct.categoryID" ng-options="c.categoryID as c.categoryName for c in categories" required>
                  <option value="">Select Category</option>
                </select>

                <label for="minstock-edit">MinStock</label>
                <input id="minstock-edit" type="number" placeholder="Enter MinStock" ng-model="editingProduct.minStock" min="0" step="1" />

                <label for="quantity-edit">Quantity</label>
                <input id="quantity-edit" type="number" placeholder="Enter Quantity" ng-model="editingProduct.quantity" min="0" step="1" />

                <label for="status-edit">Status</label>
                <select id="status-edit" ng-model="editingProduct.status">
                  <option value="Active">Active</option>
                  <option value="Inactive">Inactive</option>
                </select>

                <label for="imageInputEdit">Image</label>
                <input id="imageInputEdit" type="file" accept="image/*" onchange="angular.element(this).scope().previewImageEdit(this)">
                <img id="previewEdit" style="width:60px;height:60px;margin-top:5px;border-radius:6px;" ng-if="editingProduct.image" ng-src="{{editingProduct.image}}" />
              </div>

              <div class="dialog-footer">
                <button type="button" class="cancel">Cancel</button>
                <input class="submit" type="submit" value="Update Product" ng-disabled="frmEdit.$invalid || savingEdit" />
              </div>
            </form>
          </div>
        </div>

        <!-- DELETE CONFIRM -->
        <div class="form-delete" ng-class="{open:showDelete}" ng-click="closeDeleteOnOverlay($event)">
          <div class="form-delete__content">
            <h3 class="title">Delete Product</h3>
            <p class="desc">
              Are you sure you want to delete the Product "{{deleting.productName}}"? This action cannot be undone.
            </p>
            <div class="dialog-footer">
              <button class="cancel" ng-click="cancelDelete($event)">Cancel</button>
              <button type="button" class="submit danger" ng-click="confirmDelete()" ng-disabled="deletingBusy">
                Delete Product
              </button>
            </div>
          </div>
        </div>

      </div><!-- /.app-layout-content -->
    </div><!-- /.app-layout -->

  </div><!-- /.app-content -->

  <!-- Custom JS cuá»‘i file (má»™t báº£n) -->
  <script src="../Shared/js/product.js"></script>
</body>
</html>
