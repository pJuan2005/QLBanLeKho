<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
      rel="stylesheet"
    />

    <!-- css -->
    <link rel="stylesheet" href="../Shared/css/purchaseorder.css" />
    <script src="../Shared/angular/angular.min.js"></script>
    <script src="../Shared/angular/global.js"></script>
    <script src="../Shared/angular/purchaseorder.js"></script>
    <title>Purchase Orders</title>
  </head>

  <body ng-app="AppRetailPos" ng-controller="purchaseorderCtrl">
    <div class="app-content">
      <div class="slide-bar">
        <div class="slide-bar__header">
          <div class="app-slideBar">
            <div class="app-slideBar__left">
              <img src="../Shared/img/common/wheel.svg" alt="" class="icon" />
            </div>
            <div class="app-slideBar__right">
              <h1 class="name-app">RetailPro</h1>
              <p class="title-nameApp">Inventory & POS</p>
            </div>
          </div>
        </div>
        <div class="slide-bar__Content">
          <p class="slide-bar__label">Navigation</p>
          <!-- menu button Dashboard -->
          <a href="../AdminFE/dashboard.html" ng-if="canShow('dashboard')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/dashboard.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Dashboard</p>
              </div>
            </div>
          </a>
          <!-- menu button POS -->
          <a href="../AdminFE/pos.html" ng-if="canShow('pos')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img src="../Shared/img/common/pos.svg" alt="" class="icon" />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">POS</p>
              </div>
            </div>
          </a>
          <!-- menu button Products -->
          <a href="../AdminFE/products.html" ng-if="canShow('products')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/product.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Products</p>
              </div>
            </div>
          </a>
          <!-- menu button Categories -->
          <a href="../AdminFE/categories.html" ng-if="canShow('categories')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/category.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Categories</p>
              </div>
            </div>
          </a>
          <!-- menu button Promotions -->
          <a href="../AdminFE/promotions.html" ng-if="canShow('promotions')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/promotion.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Promotions</p>
              </div>
            </div>
          </a>
          <!-- menu button Customers -->
          <a href="../AdminFE/customers.html" ng-if="canShow('customers')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/customer.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Customers</p>
              </div>
            </div>
          </a>
          <!-- menu button Suppliers -->
          <a href="../AdminFE/suppliers.html" ng-if="canShow('suppliers')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/supplier.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Suppliers</p>
              </div>
            </div>
          </a>
          <!-- menu button Purchase Orders -->
          <a
            href="../AdminFE/purchaseorders.html"
            ng-if="canShow('purchaseOrders')"
          >
            <div class="slide-bar__MenuButton slide-bar__MenuButton--active">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/purchaseorder.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu-active">Purchase Orders</p>
              </div>
            </div>
          </a>
          <!-- menu button StockCard -->
          <a href="../AdminFE/stockcard.html" ng-if="canShow('purchaseOrders')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img src="../Shared/img/common/stock.svg" alt="" class="icon" />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Stock Management</p>
              </div>
            </div>
          </a>
          <!-- menu button Goods Receipts -->
          <a href="../AdminFE/goodsreceipts.html" ng-if="canShow('greceipts')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/goodReceipt.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Goods Receipts</p>
              </div>
            </div>
          </a>
          <!-- menu button Goods Issues -->
          <a href="../AdminFE/goodsissues.html" ng-if="canShow('gissues')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/goodIssues.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Goods Issues</p>
              </div>
            </div>
          </a>
          <!-- menu button Sales -->
          <a href="../AdminFE/sales.html" ng-if="canShow('sales')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img src="../Shared/img/common/sales.svg" alt="" class="icon" />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Sales</p>
              </div>
            </div>
          </a>
          <!-- menu button Returns -->
          <a href="../AdminFE/returns.html" ng-if="canShow('returns')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/return.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Returns</p>
              </div>
            </div>
          </a>
          <!-- menu button Payments & Debts -->
          <a href="../AdminFE/payments.html" ng-if="canShow('payments')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/payments.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Payments & Debts</p>
              </div>
            </div>
          </a>
          <!-- menu button Reports -->
          <a href="../AdminFE/reports.html" ng-if="canShow('reports')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/report.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Reports</p>
              </div>
            </div>
          </a>
          <!-- menu button Audit Log -->
          <a href="../AdminFE/auditlog.html" ng-if="canShow('auditLog')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/auditlog.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Audit Log</p>
              </div>
            </div>
          </a>
          <!-- menu button Users -->
          <a href="../AdminFE/users.html" ng-if="canShow('users')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img src="../Shared/img/common/user.svg" alt="" class="icon" />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Users</p>
              </div>
            </div>
          </a>
          <!-- menu button Settings -->
          <a href="../AdminFE/settings.html" ng-if="canShow('settings')">
            <div class="slide-bar__MenuButton">
              <div class="MenuButton-left">
                <img
                  src="../Shared/img/common/setting.svg"
                  alt=""
                  class="icon"
                />
              </div>
              <div class="MenuButton-right">
                <p class="name-menu">Settings</p>
              </div>
            </div>
          </a>
        </div>
        <div class="slide-bar__footer">
          <div class="app-slide-bar">
            <div class="ava">
              <img class="ava" src="../Shared/img/common/ava.svg" alt="" />
            </div>
            <div class="info">
              <p class="name">{{currentUser.fullname}}</p>
              <p class="role">{{currentUser.role}}</p>
            </div>
          </div>
        </div>
      </div>
      <div class="app-layout">
        <div class="top-bar">
          <div class="top-bar__content">
            <div class="top-bar__left" style="visibility: hidden">
              <img src="../Shared/img/common/search.svg" alt="" class="icon" />
              <input
                class="search"
                type="text"
                placeholder="Search by categories name"
                ng-model="searchCategories"
              />
            </div>
            <div class="top-bar__right">
              <p class="role">{{currentUser.role}}</p>
              <img
                src="../Shared/img/common/ava.svg"
                alt=""
                class="ava"
                id="avatar"
              />
            </div>
          </div>
          <div class="top-bar__info" id="information">
            <div class="info-top">
              <p class="name">{{currentUser.fullname}}</p>
              <p class="email">{{currentUser.email}}</p>
            </div>
            <div class="info-mid">
              <a href="#!">
                <p class="set">Profile Settings</p>
              </a>
            </div>
            <div class="info-bottom">
              <img
                src="../Shared/img/categories/logout.svg"
                alt=""
                class="icon"
              />
              <a href="../AuthFE/login.html">
                <p class="logout">Logout</p>
              </a>
            </div>
          </div>
        </div>
        <div class="app-layout-content">
          <h1 class="name-menu">Purchase Orders</h1>
          <p class="desc">Manage and organize Purchase Orders</p>
          <div class="display-container">
            <div class="total farme">
              <p class="name-display">Total PO</p>
              <p class="data">{{stats.total}}</p>
            </div>
            <div class="Amount-Approved farme">
              <p class="name-display">Amount Approved</p>
              <p class="data">{{stats.countApproved}}</p>
            </div>
            <div class="Amount-Pending farme">
              <p class="name-display">Amount Pending</p>
              <p class="data">{{stats.countPending}}</p>
            </div>
            <div class="Amount-Processing farme">
              <p class="name-display">Amount Processing</p>
              <p class="data">{{stats.countProcessing}}</p>
            </div>
          </div>
          <div class="control">
            <!-- To√†n b·ªô ch·ªâ 1 div control-left, gi·ªëng categories -->
            <div class="control-left">
              <!-- 1. T·ª´ ng√†y (d√πng placeholder gi·∫£ v√¨ type=date kh√¥ng h·ªó tr·ª£ placeholder) -->
              <img src="../Shared/img/common/date.svg" alt="" class="icon" />
              <input
                type="date"
                class="search date-input"
                ng-model="searchFromDate"
                id="fromDate"
              />
              <label for="fromDate" class="placeholder-label">From Date</label>
            </div>

            <div class="control-left">
              <img src="../Shared/img/common/date.svg" alt="" class="icon" />
              <input
                type="date"
                class="search date-input"
                ng-model="searchToDate"
                id="toDate"
              />
              <label for="toDate" class="placeholder-label">To Date</label>
            </div>

            <div class="control-left">
              <img src="../Shared/img/common/search.svg" alt="" class="icon" />
              <input
                type="number"
                class="search money-input"
                placeholder="Min Amount"
                ng-model="searchMinAmount"
              />
            </div>

            <div class="control-left">
              <img src="../Shared/img/common/search.svg" alt="" class="icon" />
              <input
                type="number"
                class="search money-input"
                placeholder="Max Amount"
                ng-model="searchMaxAmount"
              />
            </div>

            <div class="control-left">
              <img src="../Shared/img/common/search.svg" alt="" class="icon" />
              <select class="search status-select" ng-model="searchStatus">
                <option value="">All Status</option>
                <option value="Pending">Pending</option>
                <option value="Processing">Processing</option>
                <option value="Approved">Approved</option>
              </select>
            </div>
          </div>
          <!-- ======================== PH·∫¶N D∆Ø·ªöI CONTROL: PH√ÇN TRANG + EXPORT + ADD PO ======================== -->
          <div class="bottom-control">
            <!-- Ph√¢n trang  -->
            <div class="pager" ng-if="pager.total > 0">
              <div class="pager-info">
                Showing
                {{((pager.page-1)*pager.size)+1}}-{{Math.min(pager.page*pager.size,
                pager.total)}} of {{pager.total}} items
              </div>
              <div class="page-nav">
                <label>
                  Page size:
                  <select ng-model="pager.size" ng-change="changeSize()">
                    <option value="10">10</option>
                    <option value="20">20</option>
                    <option value="30">30</option>
                    <option value="50">50</option>
                  </select>
                </label>
                <button
                  class="btn ghost"
                  ng-disabled="pager.page === 1"
                  ng-click="go(1)"
                >
                  ¬´
                </button>
                <button
                  class="btn ghost"
                  ng-disabled="pager.page === 1"
                  ng-click="go(pager.page-1)"
                >
                  Prev
                </button>
                <span class="page-no">
                  Page {{pager.page}} of {{pager.pages}}
                </span>
                <button
                  class="btn ghost"
                  ng-disabled="pager.page >= pager.pages"
                  ng-click="go(pager.page+1)"
                >
                  Next
                </button>
                <button
                  class="btn ghost"
                  ng-disabled="pager.page >= pager.pages"
                  ng-click="go(pager.pages)"
                >
                  ¬ª
                </button>
              </div>
            </div>
            <!-- Th√™m flex: 1 ƒë·ªÉ chi·∫øm ch·ªó tr√°i, ƒë·∫©y pager gi·ªØa v√† control-right sang ph·∫£i -->
            <div style="flex: 1"></div>

            <div class="control-right">
              <!-- Add Purchase Order -->
              <div class="add" id="btnOpenAdd" ng-click="openAddModal()">
                <img
                  src="../Shared/img/common/plus.svg"
                  alt="Add"
                  class="plus"
                />
                <p class="add-po">Add Purchase Order</p>
              </div>
            </div>
          </div>
          <!-- table -->
          <div class="card">
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th class="id">POID</th>
                    <th class="id">SupplierID</th>
                    <th class="Date">OrderDate</th>
                    <th class="Total">TotalAmount</th>
                    <th class="Status">Status</th>
                    <th class="action txt-right">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="po in purchaseOrders">
                    <td>{{po.poid}}</td>
                    <td>{{po.supplierID}}</td>
                    <td>{{formatDate(po.orderDate)}}</td>
                    <td>{{(po.totalAmount || 0) | number:0}} ‚Ç´</td>
                    <td>{{po.status}}</td>

                    <td class="txt-right">
                      <button class="link" ng-click="viewDetail(po)">
                        üîç Detail
                      </button>
                      <button class="link" ng-click="edit(po)">‚úé Edit</button>
                      <button class="link danger" ng-click="remove(po)">
                        üóë Delete
                      </button>
                      <button class="link" ng-click="exportPO(po)">
                        üñ® Export
                      </button>
                    </td>
                  </tr>

                  <tr
                    ng-if="(purchaseOrders 
                                    | filter:searchPurchaseOrder 
                                    | filter:searchFromDate 
                                    | filter:searchToDate 
                                    | filter:searchMinAmount 
                                    | filter:searchMaxAmount 
                                    | filter:searchStatus).length == 0"
                  >
                    <td colspan="6" class="empty">No Purchase Orders Found</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <!-- form -->
          <div class="form">
            <!-- add -->
            <div class="form-add" ng-class="{open:showAdd}">
              <div class="form-add__content">
                <h3 class="title">Add Purchase Order</h3>
                <p class="desc">Create a new purchase order</p>
                <form name="frmAddPO" ng-submit="addPurchaseOrder()">
                  <label for="supplier-add">Supplier ID *</label>
                  <input
                    type="number"
                    id="supplier-add"
                    ng-model="newPurchaseOrder.SupplierID"
                    required
                  />

                  <label for="status-add">Status *</label>
                  <select
                    id="status-add"
                    ng-model="newPurchaseOrder.Status"
                    required
                  >
                    <option value="Pending">Pending</option>
                    <option value="Processing">Processing</option>
                    <option value="Approved">Approved</option>
                  </select>

                  <div class="dialog-footer">
                    <button
                      type="button"
                      class="cancel"
                      ng-click="closeAddModal()"
                    >
                      Cancel
                    </button>
                    <input
                      class="submit"
                      type="submit"
                      value="Add Purchase Order"
                      ng-disabled="frmAddPO.$invalid||savingAdd"
                    />
                  </div>
                </form>
              </div>
            </div>

            <!-- Edit -->
            <div class="form-edit-po">
              <div class="form-edit-po__content">
                <h3 class="title">Edit Purchase Order</h3>
                <p class="desc">Update supplier and status</p>
                <form name="frmEditPO" ng-submit="updatePurchaseOrder()">
                  <!-- SupplierID -->
                  <label for="supplier-edit">Supplier ID *</label>
                  <input
                    type="number"
                    id="supplier-edit"
                    ng-model="editingPO.SupplierID"
                    required
                    min="1"
                  />

                  <!-- Status -->
                  <!-- Status -->
                  <label for="status-edit">Status *</label>
                  <select id="status-edit" ng-model="editingPO.Status" required>
                    <option value="Pending">Pending</option>
                    <option value="Processing">Processing</option>
                    <option value="Approved">Approved</option>
                  </select>

                  <!-- Footer -->
                  <div class="dialog-footer">
                    <button type="button" class="cancel">Cancel</button>
                    <input
                      class="submit"
                      type="submit"
                      value="Update Purchase Order"
                      ng-disabled="frmEditPO.$invalid || savingEditPO"
                    />
                  </div>
                </form>
              </div>
            </div>

            <!-- delete -->
            <div
              class="form-delete"
              ng-class="{open:showDelete}"
              ng-click="closeDeleteOnOverlay($event)"
            >
              <div class="form-delete__content">
                <h3 class="title">Delete Purchase Order</h3>
                <p class="desc">
                  Are you sure you want to delete the purchase order with POID
                  "{{deleting.POID}}"? This action cannot be undone.
                </p>
                <div class="dialog-footer">
                  <button class="cancel" ng-click="cancelDelete($event)">
                    Cancel
                  </button>
                  <button class="submit danger" ng-click="confirmDelete()">
                    Delete Purchase Order
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Detail (Purchase Order Details) -->
    <div class="form-detail-po" ng-class="{open:showDetail}">
      <div class="form-detail-po__content">
        <h3 class="title">Purchase Order Details</h3>
        <p class="desc">Chi ti·∫øt ƒë∆°n h√†ng cho POID {{detailPO.POID}}</p>

        <!-- B·∫£ng hi·ªÉn th·ªã chi ti·∫øt -->
        <div class="card">
          <div class="table-responsive">
            <table class="table">
              <thead>
                <tr>
                  <th>POID</th>
                  <th>ProductID</th>
                  <th>NameProduct</th>
                  <th>Quantity</th>
                  <th>Unit Price</th>
                </tr>
              </thead>
              <tbody>
                <tr
                  ng-repeat="d in purchaseOrderDetails"
                  ng-click="selectDetail(d)"
                >
                  <td>{{d.poid}}</td>
                  <td>{{d.productID}}</td>
                  <td>{{d.nameProduct}}</td>
                  <td>{{d.quantity}}</td>
                  <td>{{d.unitPrice | number:0}} ‚Ç´</td>
                </tr>
                <tr ng-if="purchaseOrderDetails.length === 0">
                  <td colspan="5" class="empty">No details found</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Form th√™m chi ti·∫øt ƒë∆°n h√†ng -->
        <div class="form-add-detail">
          <h4 class="sub-title">Add Purchase Order Detail</h4>
          <form name="frmAddDetail" ng-submit="addDetail()">
            <div class="form-row">
              <label for="product-id">ProductID *</label>
              <input
                type="number"
                id="product-id"
                ng-model="newDetail.ProductID"
                required
                min="1"
              />
            </div>

            <div class="form-row">
              <label for="quantity">Quantity *</label>
              <input
                type="number"
                id="quantity"
                ng-model="newDetail.Quantity"
                required
                min="1"
              />
            </div>

            <div class="form-row">
              <label for="unit-price">Unit Price *</label>
              <input
                type="number"
                id="unit-price"
                ng-model="newDetail.UnitPrice"
                required
                min="0"
              />
            </div>

            <div class="dialog-footer">
              <button type="button" class="cancel" ng-click="resetAddDetail()">
                Reset
              </button>
              <input
                type="submit"
                class="submit"
                value="Add Detail"
                ng-disabled="frmAddDetail.$invalid || savingDetail"
              />
            </div>
          </form>
        </div>
        <div class="dialog-footer">
          <button type="button" class="danger" ng-click="deleteDetail()">
            Delete Detail
          </button>
        </div>

        <!-- Footer -->
        <div class="dialog-footer">
          <button type="button" class="cancel" ng-click="closeDetailModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <script src="../Shared/js/purchaseorder.js"></script>
  </body>
</html>
